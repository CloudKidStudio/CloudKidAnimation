!function(){var t=function(){this._timelines=[],this._boundUpdate=this._update.bind(this)},i=t.prototype={},n=null;i._timelines=null,i._numAnims=0,i._updateAlias="animator",i._boundUpdate=null,i.soundLib=null;var e=null;t.init=function(){n=new t,e=[]},Object.defineProperty(t,"instance",{get:function(){return n}}),i.play=function(t,i,n,u,d,p,r){if(null===t||!(t instanceof PIXI.Spine)&&!t.updateAnim)return void(n&&n());this.stop(t),u=u||!1,p=p?.001*p:0;var h=e.length?e.pop().init(t,n||null,d||1):new o(t,n||null,d||1);if(h.isSpine){var c;if("string"==typeof i){if(!s(t,i))return this._repool(h),void(n&&n());t.state.setAnimationByName(i,u),t.updateAnim(p>0?p*h.speed:0)}else if("string"==typeof i[0]){for(t.state.setAnimationByName(i[0],!1),c=1;c<i.length;++c)t.state.addAnimationByName(i[c],u&&c==i.length-1);t.updateAnim(p>0?p*h.speed:0)}else for(h.spineStates=new Array(i.length),h.speed=new Array(i.length),c=0;c<i.length;++c){var m=new PIXI.spine.AnimationState(t.stateData);h.spineStates[c]=m,m.setAnimationByName(i[c].anim,u||i[c].loop),h.speed[c]=i[c].speed?i[c].speed:d||1,p>0&&m.update(p*h.speed[c]),m.apply(t.skeleton)}}else i&&i instanceof Array&&(t.textures=i,t.updateDuration()),t.loop=u,t.onComplete=this._onMovieClipDone.bind(this,h),t.gotoAndPlay(0),p>0&&t.update(p*h.speed);return r&&(h.playSound=!0,h.soundStart=r.start,h.soundAlias=r.alias,0===h.soundStart?h.soundInst=cloudkid.Sound.instance.play(h.soundAlias,void 0,void 0,void 0,void 0,void 0,void 0,l.bind(this,h),a.bind(this,h)):cloudkid.Sound.instance.preloadSound(r.alias)),h.loop=u,h.time=p>0?p:0,this._timelines.push(h),1==++this._numAnims&&cloudkid.OS.instance.addUpdateCallback(this._updateAlias,this._boundUpdate),h};var s=function(t,i){return null!==t.stateData.skeletonData.findAnimation(i)};i.stop=function(t,i){for(var n=0;n<this._numAnims;++n)if(this._timelines[n].clip===t){var e=this._timelines[n];this._timelines.splice(n,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),i&&e.callback&&e.callback(),e.soundInst&&e.soundInst.stop(),this._repool(e);break}},i.stopAll=function(){for(var t=0;t<this._numAnims;++t){var i=this._timelines[t];i.soundInst&&i.soundInst.stop(),this._repool(i);break}cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._timelines.length=this._numAnims=0},i._repool=function(t){t.clip=null,t.callback=null,t.loop=!1,t.spineStates=null,t.speed=null,t.soundInst=null,e.push(t)},i._update=function(t){for(var i=.001*t,n=this._numAnims-1;n>=0;--n){var e=this._timelines[n];if(!e.paused){var s=e.time;if(e.soundInst){if(!e.soundInst.isValid){this._onMovieClipDone(e);continue}e.time=e.soundStart+.001*e.soundInst.position}else e.time+=i,e.playSound&&e.time>=e.soundStart&&(e.time=e.soundStart,e.soundInst=this.soundLib.play(e.soundAlias,l.bind(this,e),a.bind(this,e)));var o=e.clip;if(e.isSpine)if(e.spineStates){for(var u=!1,d=0,p=e.spineStates.length;p>d;++d){var r=e.spineStates[d];r.update((e.time-s)*e.speed[d]),r.apply(o.skeleton),!r.currentLoop&&r.isComplete()&&(u=!0)}u&&(this._timelines.splice(n,1),this._numAnims--,e.callback&&e.callback(),this._repool(e))}else{o.updateAnim((e.time-s)*e.speed);var h=o.state;!h.currentLoop&&0===h.queue.length&&h.currentTime>=h.current.duration&&(this._timelines.splice(n,1),this._numAnims--,e.callback&&e.callback(),this._repool(e))}else o.updateAnim((e.time-s)*e.speed)}}0===this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias)};var a=function(t){t.playSound=!1,t.soundEnd=t.soundStart+.001*t.soundInst.length},l=function(t){t.time=t.soundEnd||t.soundStart,t.soundInst=null};i._onMovieClipDone=function(t){for(var i=0;i<this._numAnims;++i)if(this._timelines[i]===t){var n=this._timelines[i];n.clip.onComplete=null,this._timelines.splice(i,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),n.callback&&n.callback(),this._repool(n);break}},i.destroy=function(){n=null,e=null,this._timelines=null,cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._boundUpdate=null};var o=function(t,i,n){this.init(t,i,n)};o.constructor=o,o.prototype.init=function(t,i,n){return this.clip=t,this.isSpine=t instanceof PIXI.Spine,this.callback=i,this.speed=n,this.spineStates=null,this.loop=null,this.time=0,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this._paused=!1,this},Object.defineProperty(o.prototype,"paused",{get:function(){return this._paused},set:function(t){t!=this._paused&&(this._paused=!!t,this.soundInst&&(this.paused?this.soundInst.pause():this.soundInst.unpause()))}}),namespace("cloudkid").PixiAnimator=t}();