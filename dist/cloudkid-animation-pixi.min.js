!function(){var t=function(){this._timelines=[],this._boundUpdate=this._update.bind(this)},n=t.prototype={},i=null;n._timelines=null,n._numAnims=0,n._updateAlias="animator",n._boundUpdate=null,n.soundLib=null;var e=null;t.init=function(){i=new t,e=[]},Object.defineProperty(t,"instance",{get:function(){return i}}),n.play=function(t,n,i,u,d,p,r){if(null===t||!(t instanceof PIXI.Spine)&&!t.updateAnim)return void(i&&i());this.stop(t),u=u||!1,p=p?.001*p:0;var c=e.length?e.pop().init(t,i||null,d||1):new o(t,i||null,d||1);if(c.isSpine){var h;if("string"==typeof n){if(!s(t,n))return this._repool(c),void(i&&i());t.state.setAnimationByName(n,u),t.updateAnim(p>0?p*c.speed:0)}else if("string"==typeof n[0]){for(t.state.setAnimationByName(n[0],!1),h=1;h<n.length;++h)t.state.addAnimationByName(n[h],u&&h==n.length-1);t.updateAnim(p>0?p*c.speed:0)}else for(c.spineStates=new Array(n.length),c.speed=new Array(n.length),h=0;h<n.length;++h){var m=new PIXI.spine.AnimationState(t.stateData);c.spineStates[h]=m,m.setAnimationByName(n[h].anim,u||n[h].loop),c.speed[h]=n[h].speed?n[h].speed:d||1,p>0&&m.update(p*c.speed[h]),m.apply(t.skeleton)}}else n&&n instanceof Array&&(t.textures=n,t.updateDuration()),t.loop=u,t.onComplete=this._onMovieClipDone.bind(this,c),t.gotoAndPlay(0),p>0&&t.update(p*c.speed);return r&&(c.playSound=!0,c.soundStart=r.start,c.soundAlias=r.alias,0===c.soundStart?c.soundInst=cloudkid.Sound.instance.play(c.soundAlias,l.bind(this,c),a.bind(this,c)):cloudkid.Sound.instance.preloadSound(r.alias)),c.loop=u,c.time=p>0?p:0,this._timelines.push(c),1==++this._numAnims&&cloudkid.OS.instance.addUpdateCallback(this._updateAlias,this._boundUpdate),c},n.instanceHasAnimation=function(t,n){return t instanceof PIXI.Spine?s(t,n):!1};var s=function(t,n){return null!==t.stateData.skeletonData.findAnimation(n)};n.stop=function(t,n){for(var i=0;i<this._numAnims;++i)if(this._timelines[i].clip===t){var e=this._timelines[i];this._timelines.splice(i,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),n&&e.callback&&e.callback(),e.soundInst&&e.soundInst.stop(),this._repool(e);break}},n.stopAll=function(){for(var t=0;t<this._numAnims;++t){var n=this._timelines[t];n.soundInst&&n.soundInst.stop(),this._repool(n);break}cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._timelines.length=this._numAnims=0},n._repool=function(t){t.clip=null,t.callback=null,t.loop=!1,t.spineStates=null,t.speed=null,t.soundInst=null,e.push(t)},n._update=function(t){for(var n=.001*t,i=this._numAnims-1;i>=0;--i){var e=this._timelines[i];if(!e.paused){var s=e.time;if(e.soundInst){if(!e.soundInst.isValid){this._onMovieClipDone(e);continue}e.time=e.soundStart+.001*e.soundInst.position}else e.time+=n,e.playSound&&e.time>=e.soundStart&&(e.time=e.soundStart,e.soundInst=this.soundLib.play(e.soundAlias,l.bind(this,e),a.bind(this,e)));var o=e.clip;if(e.isSpine)if(e.spineStates){for(var u=!1,d=0,p=e.spineStates.length;p>d;++d){var r=e.spineStates[d];r.update((e.time-s)*e.speed[d]),r.apply(o.skeleton),!r.currentLoop&&r.isComplete()&&(u=!0)}u&&(this._timelines.splice(i,1),this._numAnims--,e.callback&&e.callback(),this._repool(e))}else{o.updateAnim((e.time-s)*e.speed);var c=o.state;!c.currentLoop&&0===c.queue.length&&c.currentTime>=c.current.duration&&(this._timelines.splice(i,1),this._numAnims--,e.callback&&e.callback(),this._repool(e))}else o.updateAnim((e.time-s)*e.speed)}}0===this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias)};var a=function(t){t.playSound=!1,t.soundEnd=t.soundStart+.001*t.soundInst.length},l=function(t){t.time=t.soundEnd||t.soundStart,t.soundInst=null};n._onMovieClipDone=function(t){for(var n=0;n<this._numAnims;++n)if(this._timelines[n]===t){var i=this._timelines[n];i.clip.onComplete=null,this._timelines.splice(n,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),i.callback&&i.callback(),this._repool(i);break}},n.destroy=function(){i=null,e=null,this._timelines=null,cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._boundUpdate=null};var o=function(t,n,i){this.init(t,n,i)};o.constructor=o,o.prototype.init=function(t,n,i){return this.clip=t,this.isSpine=t instanceof PIXI.Spine,this.callback=n,this.speed=i,this.spineStates=null,this.loop=null,this.time=0,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this._paused=!1,this},Object.defineProperty(o.prototype,"paused",{get:function(){return this._paused},set:function(t){t!=this._paused&&(this._paused=!!t,this.soundInst&&(this.paused?this.soundInst.pause():this.soundInst.unpause()))}}),namespace("cloudkid").PixiAnimator=t}();