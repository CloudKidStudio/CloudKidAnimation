!function(){var t=function(){this._timelines=[],this._boundUpdate=this._update.bind(this)},n=t.prototype={},i=null;n._timelines=null,n._numAnims=0,n._updateAlias="animator",n._boundUpdate=null,n.soundLib=null;var s=null;t.init=function(){i=new t,s=[]},Object.defineProperty(t,"instance",{get:function(){return i}}),n.play=function(t,n,i,u,d,p,r){if(null===t||!(t instanceof PIXI.Spine)&&!t.updateAnim)return void(i&&i());this.stop(t),u=u||!1,p=p?.001*p:0;var c=s.length?s.pop().init(t,i||null,d||1):new o(t,i||null,d||1);if(c.isSpine){var h;if("string"==typeof n){if(!e(t,n))return this._repool(c),void(i&&i());t.state.setAnimationByName(n,u),t.updateAnim(p>0?p*c.speed:0)}else if("string"==typeof n[0]){for(t.state.setAnimationByName(n[0],!1),h=1;h<n.length;++h)t.state.addAnimationByName(n[h],u&&h==n.length-1);t.updateAnim(p>0?p*c.speed:0)}else for(c.spineStates=new Array(n.length),c.speed=new Array(n.length),h=0;h<n.length;++h){var m=new PIXI.spine.AnimationState(t.stateData);c.spineStates[h]=m,m.setAnimationByName(n[h].anim,u||n[h].loop),c.speed[h]=n[h].speed?n[h].speed:d||1,p>0&&m.update(p*c.speed[h]),m.apply(t.skeleton)}}else n&&n instanceof Array&&(t.textures=n,t.updateDuration()),t.loop=u,t.onComplete=this._onMovieClipDone.bind(this,c),t.gotoAndPlay(0),p>0&&t.update(p*c.speed);return r&&(c.playSound=!0,"string"==typeof r?(c.soundStart=0,c.soundAlias=r):(c.soundStart=r.start>0?r.start:0,c.soundAlias=r.alias),0===c.soundStart?c.soundInst=cloudkid.Sound.instance.play(c.soundAlias,l.bind(this,c),a.bind(this,c)):cloudkid.Sound.instance.preloadSound(r.alias)),c.loop=u,c.time=p>0?p:0,this._timelines.push(c),1==++this._numAnims&&cloudkid.OS.instance.addUpdateCallback(this._updateAlias,this._boundUpdate),c},n.instanceHasAnimation=function(t,n){return t instanceof PIXI.Spine?e(t,n):!1};var e=function(t,n){return null!==t.stateData.skeletonData.findAnimation(n)};n.stop=function(t,n){for(var i=0;i<this._numAnims;++i)if(this._timelines[i].clip===t){var s=this._timelines[i];this._timelines.splice(i,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),n&&s.callback&&s.callback(),s.soundInst&&s.soundInst.stop(),this._repool(s);break}},n.stopAll=function(){for(var t=0;t<this._numAnims;++t){var n=this._timelines[t];n.soundInst&&n.soundInst.stop(),this._repool(n);break}cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._timelines.length=this._numAnims=0},n._repool=function(t){t.clip=null,t.callback=null,t.loop=!1,t.spineStates=null,t.speed=null,t.soundInst=null,s.push(t)},n._update=function(t){for(var n=.001*t,i=this._numAnims-1;i>=0;--i){var s=this._timelines[i];if(!s.paused){var e=s.time;if(s.soundInst){if(!s.soundInst.isValid){this._onMovieClipDone(s);continue}s.time=s.soundStart+.001*s.soundInst.position}else s.time+=n,s.playSound&&s.time>=s.soundStart&&(s.time=s.soundStart,s.soundInst=this.soundLib.play(s.soundAlias,l.bind(this,s),a.bind(this,s)));var o=s.clip;if(s.isSpine)if(s.spineStates){for(var u=!1,d=0,p=s.spineStates.length;p>d;++d){var r=s.spineStates[d];r.update((s.time-e)*s.speed[d]),r.apply(o.skeleton),!r.currentLoop&&r.isComplete()&&(u=!0)}u&&(this._timelines.splice(i,1),this._numAnims--,s.callback&&s.callback(),this._repool(s))}else{o.updateAnim((s.time-e)*s.speed);var c=o.state;!c.currentLoop&&0===c.queue.length&&c.currentTime>=c.current.duration&&(this._timelines.splice(i,1),this._numAnims--,s.callback&&s.callback(),this._repool(s))}else o.updateAnim((s.time-e)*s.speed)}}0===this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias)};var a=function(t){t.playSound=!1,t.soundEnd=t.soundStart+.001*t.soundInst.length},l=function(t){t.soundEnd>0&&t.time<t.soundEnd&&(t.time=t.soundEnd),t.soundInst=null};n._onMovieClipDone=function(t){for(var n=0;n<this._numAnims;++n)if(this._timelines[n]===t){var i=this._timelines[n];i.clip.onComplete=null,this._timelines.splice(n,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),i.callback&&i.callback(),this._repool(i);break}},n.destroy=function(){i=null,s=null,this._timelines=null,cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._boundUpdate=null};var o=function(t,n,i){this.init(t,n,i)};o.constructor=o,o.prototype.init=function(t,n,i){return this.clip=t,this.isSpine=t instanceof PIXI.Spine,this.callback=n,this.speed=i,this.spineStates=null,this.loop=null,this.time=0,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this._paused=!1,this},Object.defineProperty(o.prototype,"paused",{get:function(){return this._paused},set:function(t){t!=this._paused&&(this._paused=!!t,this.soundInst&&(this.paused?this.soundInst.pause():this.soundInst.unpause()))}}),namespace("cloudkid").PixiAnimator=t}();