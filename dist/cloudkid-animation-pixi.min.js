!function(){"use strict";var t=function(){this._timelines=[],this._boundUpdate=this._update.bind(this)},n=t.prototype={},i=null;n._timelines=null,n._numAnims=0,n._updateAlias="animator",n._boundUpdate=null,n.soundLib=null;var s=null;n.captions=null,t.init=function(){i=new t,s=[]},Object.defineProperty(t,"instance",{get:function(){return i}}),n.play=function(t,n,i,u,p,d,r){var h=null;if(i&&"function"==typeof i?(h=i,i={}):i||(i={}),null===t||!(t instanceof PIXI.Spine)&&!t.updateAnim)return void(h&&h());this.stop(t),h=i.callback||h||null,u=i.loop||u||!1,p=i.speed||p||1,d=i.startTime||d,d=d?.001*d:0,r=i.soundData||r||null;var c=s.length?s.pop().init(t,h,p):new l(t,h,p);if(c.isSpine){var m;if("string"==typeof n){if(!e(t,n))return this._repool(c),void(h&&h());t.state.setAnimationByName(n,u),t.updateAnim(d>0?d*c.speed:0)}else if("string"==typeof n[0]){for(t.state.setAnimationByName(n[0],!1),m=1;m<n.length;++m)t.state.addAnimationByName(n[m],u&&m==n.length-1);t.updateAnim(d>0?d*c.speed:0)}else for(c.spineStates=new Array(n.length),c.speed=new Array(n.length),m=0;m<n.length;++m){var _=new PIXI.spine.AnimationState(t.stateData);c.spineStates[m]=_,_.setAnimationByName(n[m].anim,u||n[m].loop),c.speed[m]=n[m].speed?n[m].speed:p||1,d>0&&_.update(d*c.speed[m]),_.apply(t.skeleton)}}else n&&n instanceof Array&&(t.textures=n,t.updateDuration()),t.loop=u,t.onComplete=this._onMovieClipDone.bind(this,c),t.gotoAndPlay(0),d>0&&t.updateAnim(d*c.speed);return r&&(c.playSound=!0,"string"==typeof r?(c.soundStart=0,c.soundAlias=r):(c.soundStart=r.start>0?r.start:0,c.soundAlias=r.alias),c.useCaptions=this.captions&&this.captions.hasCaption(c.soundAlias),0===c.soundStart?c.soundInst=this.soundLib.play(c.soundAlias,o.bind(this,c),a.bind(this,c)):this.soundLib.preloadSound&&this.soundLib.preloadSound(r.alias)),c.loop=u,c.time=d>0?d:0,this._timelines.push(c),1==++this._numAnims&&cloudkid.OS.instance.addUpdateCallback(this._updateAlias,this._boundUpdate),c},n.instanceHasAnimation=function(t,n){return t instanceof PIXI.Spine?e(t,n):!1};var e=function(t,n){return null!==t.stateData.skeletonData.findAnimation(n)};n.stop=function(t,n){for(var i=0;i<this._numAnims;++i)if(this._timelines[i].clip===t){var s=this._timelines[i];this._timelines.splice(i,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),n&&s.callback&&s.callback(),s.soundInst&&s.soundInst.stop(),this._repool(s);break}},n.stopAll=function(){for(var t=0;t<this._numAnims;++t){var n=this._timelines[t];n.soundInst&&n.soundInst.stop(),this._repool(n);break}cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._timelines.length=this._numAnims=0},n._repool=function(t){t.clip=null,t.callback=null,t.loop=!1,t.spineStates=null,t.speed=null,t.soundInst=null,s.push(t)},n._update=function(t){for(var n=.001*t,i=this._numAnims-1;i>=0;--i){var s=this._timelines[i];if(!s.paused){var e=s.time;if(s.soundInst){if(!s.soundInst.isValid){this._onMovieClipDone(s);continue}s.time=s.soundStart+.001*s.soundInst.position,s.useCaptions&&this.captions.seek(s.soundInst.position)}else s.time+=n,s.playSound&&s.time>=s.soundStart&&(s.time=s.soundStart,s.soundInst=this.soundLib.play(s.soundAlias,o.bind(this,s),a.bind(this,s)),s.useCaptions&&(this.captions.isSlave=!0,this.captions.run(s.soundAlias)));var l=s.clip;if(s.isSpine)if(s.spineStates){for(var u=!1,p=0,d=s.spineStates.length;d>p;++p){var r=s.spineStates[p];r.update((s.time-e)*s.speed[p]),r.apply(l.skeleton),!r.currentLoop&&r.isComplete()&&(u=!0)}u&&(this._timelines.splice(i,1),this._numAnims--,s.callback&&s.callback(),this._repool(s))}else{l.updateAnim((s.time-e)*s.speed);var h=l.state;!h.currentLoop&&0===h.queue.length&&h.currentTime>=h.current.duration&&(this._timelines.splice(i,1),this._numAnims--,s.callback&&s.callback(),this._repool(s))}else l.updateAnim((s.time-e)*s.speed)}}0===this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias)};var a=function(t){t.playSound=!1,t.soundEnd=t.soundStart+.001*t.soundInst.length},o=function(t){t.soundEnd>0&&t.time<t.soundEnd&&(t.time=t.soundEnd),t.soundInst=null};n._onMovieClipDone=function(t){for(var n=0;n<this._numAnims;++n)if(this._timelines[n]===t){var i=this._timelines[n];i.clip.onComplete=null,this._timelines.splice(n,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),i.callback&&i.callback(),this._repool(i);break}},n.destroy=function(){this.captions&&this.captions.destroy(),this.captions=null,i=null,s=null,this._timelines=null,cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._boundUpdate=null};var l=function(t,n,i){this.init(t,n,i)};l.constructor=l,l.prototype.init=function(t,n,i){return this.clip=t,this.isSpine=t instanceof PIXI.Spine,this.callback=n,this.speed=i,this.spineStates=null,this.loop=null,this.time=0,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this.useCaptions=!1,this._paused=!1,this},Object.defineProperty(l.prototype,"paused",{get:function(){return this._paused},set:function(t){t!=this._paused&&(this._paused=!!t,this.soundInst&&(this.paused?this.soundInst.pause():this.soundInst.unpause()))}}),namespace("cloudkid").PixiAnimator=t}();