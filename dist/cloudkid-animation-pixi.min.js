!function(){"use strict";var t=function(){this._timelines=[],this._boundUpdate=this._update.bind(this)},i=t.prototype={},n=null;i._timelines=null,i._numAnims=0,i._updateAlias="animator",i._boundUpdate=null,i.soundLib=null;var s=null;i.captions=null,t.init=function(){n=new t,s=[]},Object.defineProperty(t,"instance",{get:function(){return n}}),i.play=function(t,i,n,u,p,d,r){var h=null;if(n&&"function"==typeof n?(h=n,n={}):n||(n={}),null===t||!(t instanceof PIXI.Spine)&&!t.updateAnim)return void(h&&h());this.stop(t),h=n.callback||h||null,u=n.loop||u||!1,p=n.speed||p||1,d=n.startTime||d,d=d?.001*d:0,r=n.soundData||r||null;var c=s.length?s.pop().init(t,h,p):new l(t,h,p);if(c.isSpine){var m;if("string"==typeof i){if(!e(t,i))return this._repool(c),void(h&&h());t.state.setAnimationByName(i,u),t.updateAnim(d>0?d*c.speed:0)}else if("string"==typeof i[0]){for(t.state.setAnimationByName(i[0],!1),m=1;m<i.length;++m)t.state.addAnimationByName(i[m],u&&m==i.length-1);t.updateAnim(d>0?d*c.speed:0)}else for(c.spineStates=new Array(i.length),c.speed=new Array(i.length),m=0;m<i.length;++m){var _=new PIXI.spine.AnimationState(t.stateData);c.spineStates[m]=_,_.setAnimationByName(i[m].anim,u||i[m].loop),c.speed[m]=i[m].speed?i[m].speed:p||1,d>0&&_.update(d*c.speed[m]),_.apply(t.skeleton)}}else i&&i instanceof Array&&(t.textures=i,t.updateDuration()),t.loop=u,t.onComplete=this._onMovieClipDone.bind(this,c),t.gotoAndPlay(0),d>0&&t.updateAnim(d*c.speed);return r&&(c.playSound=!0,"string"==typeof r?(c.soundStart=0,c.soundAlias=r):(c.soundStart=r.start>0?r.start:0,c.soundAlias=r.alias),c.useCaptions=this.captions&&this.captions.hasCaption(c.soundAlias),0===c.soundStart?c.soundInst=this.soundLib.play(c.soundAlias,o.bind(this,c),a.bind(this,c)):this.soundLib.preloadSound&&this.soundLib.preloadSound(r.alias)),c.loop=u,c.time=d>0?d:0,this._timelines.push(c),1==++this._numAnims&&cloudkid.OS.instance.addUpdateCallback(this._updateAlias,this._boundUpdate),c},i.instanceHasAnimation=function(t,i){return t instanceof PIXI.Spine?e(t,i):!1};var e=function(t,i){return null!==t.stateData.skeletonData.findAnimation(i)};i.stop=function(t,i){for(var n=0;n<this._numAnims;++n)if(this._timelines[n].clip===t){var s=this._timelines[n];this._timelines.splice(n,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),i&&s.callback&&s.callback(),s.soundInst&&s.soundInst.stop(),this._repool(s);break}},i.stopAll=function(){for(var t=0;t<this._numAnims;++t){var i=this._timelines[t];i.soundInst&&i.soundInst.stop(),this._repool(i);break}cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._timelines.length=this._numAnims=0},i._repool=function(t){t.clip=null,t.callback=null,t.loop=!1,t.spineStates=null,t.speed=null,t.soundInst=null,s.push(t)},i._update=function(t){for(var i=.001*t,n=this._numAnims-1;n>=0;--n){var s=this._timelines[n];if(!s.paused){var e=s.time;if(s.soundInst){if(!s.soundInst.isValid){this._onMovieClipDone(s);continue}var l=.001*s.soundInst.position;0>l&&(l=0),s.time=s.soundStart+l,s.useCaptions&&this.captions.seek(s.soundInst.position)}else s.time+=i,s.playSound&&s.time>=s.soundStart&&(s.time=s.soundStart,s.soundInst=this.soundLib.play(s.soundAlias,o.bind(this,s),a.bind(this,s)),s.useCaptions&&(this.captions.isSlave=!0,this.captions.run(s.soundAlias)));var u=s.clip;if(s.isSpine)if(s.spineStates){for(var p=!1,d=0,r=s.spineStates.length;r>d;++d){var h=s.spineStates[d];h.update((s.time-e)*s.speed[d]),h.apply(u.skeleton),!h.currentLoop&&h.isComplete()&&(p=!0)}p&&(this._timelines.splice(n,1),this._numAnims--,s.useCaptions&&this.captions.stop(),s.callback&&s.callback(),this._repool(s))}else{u.updateAnim((s.time-e)*s.speed);var c=u.state;!c.currentLoop&&0===c.queue.length&&c.currentTime>=c.current.duration&&(this._timelines.splice(n,1),this._numAnims--,s.useCaptions&&this.captions.stop(),s.callback&&s.callback(),this._repool(s))}else u.updateAnim((s.time-e)*s.speed)}}0===this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias)};var a=function(t){t.playSound=!1,t.soundEnd=t.soundStart+.001*t.soundInst.length},o=function(t){t.soundEnd>0&&t.time<t.soundEnd&&(t.time=t.soundEnd),t.soundInst=null};i._onMovieClipDone=function(t){for(var i=0;i<this._numAnims;++i)if(this._timelines[i]===t){var n=this._timelines[i];n.useCaptions&&this.captions.stop(),n.clip.onComplete=null,this._timelines.splice(i,1),0===--this._numAnims&&cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),n.callback&&n.callback(),this._repool(n);break}},i.destroy=function(){this.captions&&this.captions.destroy(),this.captions=null,n=null,s=null,this._timelines=null,cloudkid.OS.instance.removeUpdateCallback(this._updateAlias),this._boundUpdate=null};var l=function(t,i,n){this.init(t,i,n)};l.constructor=l,l.prototype.init=function(t,i,n){return this.clip=t,this.isSpine=t instanceof PIXI.Spine,this.callback=i,this.speed=n,this.spineStates=null,this.loop=null,this.time=0,this.soundAlias=null,this.soundInst=null,this.playSound=!1,this.soundStart=0,this.soundEnd=0,this.useCaptions=!1,this._paused=!1,this},Object.defineProperty(l.prototype,"paused",{get:function(){return this._paused},set:function(t){t!=this._paused&&(this._paused=!!t,this.soundInst&&(this.paused?this.soundInst.pause():this.soundInst.unpause()))}}),namespace("cloudkid").PixiAnimator=t}();